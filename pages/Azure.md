- MSFT services
  id:: 678f2fc3-d022-4a91-bdb4-ebd39d2ba0dd
  [[draws/2025-01-21-16-25-26.excalidraw]]
- ## Fundamentals
	- **Regions/AZs**
		- Azure regions - each region is paired with another in the same country e.g. AU Central 1 and AU Central 2.
			- Zonal - deployed to an AZ
			- Zone-redundant - deployed to multi-az
			- **Resource Groups**
				- Resources must be in 1 Resource Group
				- Resource Group is in a Region. Resources from other regions CAN in a Resource Group
				- RGs are not hierarchical
				- Resources can be moved across RGs
				- RG is ONLY a logical group. Physical resources can communicate across Resources in RG
				- Indicate resources to have the same lifetime
				- Can assign permissions (RBAC) to a RG which are inherited by Resources
				- Apply policies to RG > inherited by Resources
				- Apply budget to RG > inherited by Resources
				- Tags aren't automatically inherited from RG > Resource
			- **Subscriptions**
				- Smallest billing model/unit/boundary
				- Subscription associated to/trusts ONLY 1 Azure AD
				- Can assign permissions (RBAC) to a Subs which are inherited by RGs > Resources
				- Apply policies to Subs > inherited by RGs > Resources
				- Apply budget to Subs > inherited by RGs > Resources
				- Subscription has limits (similar to AWS resource Quotas)
				- Why/when to use subscriptions -- similar to AWS account
				- Different environments
				- Different billing req
				- Different limits
				- Security isolation
			- **Management Group**
				- MG allows to create groups of Subscriptions
				- Policies, Budgets, RBAC can be associated to MGs similar to Subscriptions and they inherit down
			- **vnet**
				- Subnets span Azs
				- 5 Ips of each subnet are reserved
					- 2 DNS
					- Lowest and highest of the range
					- 1 for GW
				- By default Internet access is available from a vnet
				- Vnets can be peered as long as CIDRs don't overlap
				- **On-prem to vnet**
					- Needs a VPN GW in a subnet.
					- Options to implement:
						- Site-2-site VPN:
							- Policy based VPN: suitable for legacy; static, single connection - not very useful
							- Route based VPN: supports **Express Routes** and Point-2-site VPN (Client VPN)
						- Express Route: Private link to Azure backbone via Meet Me sites
							- Can peer with a vnet using
								- Private Peering: Express Route GW is created in the Subnet, Transitive routing is supported e.g. Express Route to vnet A can talk to vnet B if A and B are peered
								- Microsoft Peering: When Private Link needs to talk to non-vnet resources e.g.
			- **Service Endpoints**
				- Trust subnets to Azure services e.g. Storage Account
			- **Private Endpoints**
				- Private IP to Azure service
			-
			- **Storage Accounts**
				- Are created in a region
				- Types:
					- Standard: General Purpose
					- Premium types:
						- Page Blob:
						- Block Blob:
						- File share
				- **Redundancy levels**
					- LRS - local redundant: 3 copies in single AZ
					- ZRS - zone redundant: 3 copies in 3 AZs
					- GRS - geo redundant: 3 copies in 1 AZ in region and replicated to paired region
					- GZRS - geo-zone redundant: 3 copies in 3 AZs in region and replicated to paired region
					- Standard: has all redundancy levels  
					  Premium: has LRS and ZRS only
				- **Blob**
					- Premium SSD
					- Standard SSD
					- Standard HDD
					- Ultra Disk (SSD): IOPS, Throughput can be custom set
					- SMB
					- NFS
				- **Queue**
					- FIFO queue
				- **Tables**
					- Key/Value schema-less storage
				-
			- **Databases**
				- Azure SQL DB: Managed, doesn't run in your vnet, multi-tenanted
				- Azure SQL Managed Instance: Managed, runs in your vnet. Has more compatibility features with MSSQL standalone e.g. SQL Agent, use CLR
				- **Azure Managed DB**
					- Postgres
					- Mysql
					- MariaDB
				- **DB Hyperscale**
					- Multiple servers share load by sharding data
					- Azure SQL DB has hyperscale**
				- **Cosmos DB**
					- Born in the cloud, suitable for 'cloud' apps
					- Supports multiple data models (all no-SQL)
						- Document
						- Column
						- Table (key/value)
-
- ## Certificates
	- ### Administrator Associate
		- #### Learning path
			- https://learn.microsoft.com/en-us/plans/50nrtozg28d354
			- https://learn.microsoft.com/en-us/credentials/certifications/azure-administrator/?practice-assessment-type=certification
		- #### Cloud Shell
			- Browser accessible AZ CLI with Powershell modules
			  ```
			  yourname@Azure:~$ ls
			  clouddrive
			  ```
			- Has an inbuilt editor - VS Code
			- When you open a Cloud Shell session, a temporary host is allocated to your session. This VM is preconfigured with the latest versions of PowerShell and Bash.
			- **Azure CloudDrive** - storage of Cloud Shell
			- Not suitable for
				- long running scripts (terminates after 20mins of inactivity)
				- no `sudo`
				- multi-region storage
				- multiple sessions - only 1 can be active at one time
		- **Familiarity with**
			- [[bash]]
			- [[Powershell]]
		- #### Azure Advisor
			- Free service built into Azure that provides recommendations on high availability, security, performance, and cost
		- #### Entra ID
			- ![image.png](../assets/image_1737670918283_0.png)
			- Entra Connect: sync AD DS to Entra ID
				- Sync (agent runs on AD DS)
				- Cloud Sync (agent runs on Azure)
			- Can provide identity for all MSFT services (not just Azure) {{embed ((678f2fc3-d022-4a91-bdb4-ebd39d2ba0dd))}}
			- Free tier automatically provisioned when creating a new subscription
			- [[draws/2025-01-21-15-07-45.excalidraw]]
			- At any given time, ==an Azure subscription must be associated with one, and only one, Microsoft Entra tenant==
			- ==You can associate the same Microsoft Entra tenant with multiple Azure subscriptions==
			- Applications and ServicePrincipals are its own classes
				- Application: definition of an application
				- ServicePrincipal: Application instance in EntraID
				- Application can be defined in one tenant and used it across multiple tenants by defining ServicePrincipals in each tenant
			- Entra tiers
				- Free
				- P1
					- Supports self-service password writeback
					- MFA
					- 99.9% SLA
					- Conditional Access based on device, group, location
					- Advanced security reports and alerts
				- P2
					- Risk based access
					- Privileged Identity Management e.g., permanent and temporary administrators
					-
		- #### Entra ID vs AD DS
			- [docs](https://learn.microsoft.com/en-us/training/modules/understand-azure-active-directory/3-compare-azure-active-directory-domain-services)
			  |AD DS|Entra ID|
			  |--|--|
			  |Is a directory service and uses Windows VM|Identity service for internet-based applications|
			  |Uses LDAP for querying| Uses REST API|
			  |Uses Kerberos for Authentication| Uses SAML, WS-Federation, OpenID Connect for authn and OAuth for authz|
			  |Uses OUs and GPOs (Group Policy Objects)|Uses users and groups in a flat structure|
		- #### Application authentication in Cloud
			- Options:
				- Using On-prem AD
					- On-prem to Cloud VPN and use On-prem AD
					- AD replication in the cloud
				- Entra Domain Services (P1/P2) - this is fully compatible with AD DS
			- Scenario:
				- Create a Microsoft Entra tenant and enable Microsoft Entra Domain Services
				  logseq.order-list-type:: number
				- Deploy a virtual network between its on-premises resources and the Microsoft Entra tenant.
				  logseq.order-list-type:: number
				- Enable Microsoft Entra Domain Services for this virtual network so that all on-premises users and services can use domain services from Microsoft Entra ID.
				  logseq.order-list-type:: number
		- **Enterprise Desktop**
			- AutoPilot joins device to Entra ID and enrolls in Intune
			- ![image.png](../assets/image_1737607448509_0.png){:height 278, :width 370}
			- Known-Folder-Move (KFM) - can migrate local data to cloud
			- User-State-Migration-Tool (USMT) -  migrate user state (account, files app settings), can be used for PC replacement and migrations
			- **Microsoft Intune Suite** - for asset inventory
		- #### Identity management
			- Users
				- Identity types
					- Cloud - exist only in Entra ID
						- source: **Microsoft Entra ID** or **External Microsoft Entra directory**
					- Directory synced (from on-prem AD)
						- source: **Windows Server AD**
					- Guests
						- source: **Invited User**
				- [Assign licences](https://learn.microsoft.com/en-us/training/modules/create-configure-manage-identities/3-exercise-assign-licenses-users)
				- Deleted users remain suspended for 30 days during which user can be restored. Afterwards, they are permanently deleted [Example](https://learn.microsoft.com/en-us/training/modules/create-configure-manage-identities/4-exercise-restore-remove-deleted-users)
			- Groups
				- Group types
					- Security Groups
					- Microsoft 365 Groups
				- Membership Type [Example](https://learn.microsoft.com/en-us/training/modules/create-configure-manage-identities/6-exercise-add-groups-azure-active-directory)
					- Assigned - users are manually added
					- Dynamic User - users are added based on rules
					- Dynamic Device - 2 ways to associate with Entra
						- "Registered" - personal device (BYOD)
						- "Joined" - enterprise owned device - complete control - these are shown as computer objects in Entra
			- Admin Units (AU)
				- Can add Users or Groups to Admin Units
				- Can grant Roles at AU level (as a safety features the Roles added to Groups do not get extended to Users in a Group)
			- External collaboration settings let you specify which roles in your organization can invite external users for B2B collaboration
		- #### Management Groups
			- Can be used to
				- RBAC
				- Policies
				- Budget
		- #### Cost Management
			- Hybrid Benefit - Reduce cost when on-prem licences are available
			- Azure reservations - specific service/region
			- Savings Plans - flexible compute
		- #### Policy
			- Effects
				- Audit
				- Deny
				- ...
				  ![image.png](../assets/image_1738032237062_0.png)
			- **Initiative** is a collection of Policies
		- #### Locks
			- virtual machines, subscriptions, and resource groups support locks
			- management groups or storage account data do NOT support locks
			- two types of lock
				- CANNOTDELETE
				- READONLY
			- applies to the **control plane** not at the **data plane**
		- #### VNET
			- 5 IPs are reserved
				- .0 - Network Address
				- .1 - AZ GW
				- .2 and .3 - DNS
				- .255 broadcast
			- Peering
				- Hub and Spoke
				- Hub end of the peer
					- ![image.png](../assets/image_1738111107714_0.png)
				- Spoke end of the peer
					- ![image.png](../assets/image_1738111140044_0.png)
				- Spokes are not transitive
					- Add an AZ firewall and configure it to do spoke -> spoke routing
			- VNET Manager
				- makes network peers easy between VNETs
				- allow configuration
					- create network groups (static and dynamic)
					  ![image.png](../assets/image_1738111362581_0.png){:height 160, :width 240}
				- Override NSG rules
					- Security Admin Rules
					- ![image.png](../assets/image_1738111570084_0.png)
			- NSG
				- Source
					- IP
					- Service Tag (Azure services)
					- Application Security Group
						- Tag an application NIC
						- {{video https://youtu.be/0Knf9nub4-k?t=5677}}
		- #### Azure Firewall
			- Rules
				- DNAT
				- SNAT
				- L4 Rules
				- L7 Rules
			- SKU
				- Basic
				- Standard
					- Web content filtering
					- Custom DNS
				- Premium
					- TLS in/out termination
					- URL filtering
			- Needs UDR to send traffic to Firewall
		- #### DNS
			- Public zone
			- Private zone
				- VNET auto-register allows to automatically register DNS names of resources e.g., VM
			- Azure DNS: 168.63.129.16 (only accessible from VNET)
			- Azure Private DNS resolver: access Azure DNS from on-prem
		- #### On-Prem -> Azure
		  id:: 67998bd8-540a-47be-a214-f489e49b240c
			- VPN
				- Policy based (legacy)
				- Route based (recommended)
			- Express Route
				- Private peering: Connect on-prem to VNET
				- Microsoft peering: Connect on-prem to AZ PaaS
				- Global reach: Connect multiple on-prem sites via AZ backbone
				  ![image.png](../assets/image_1738116492183_0.png)
				- ![image.png](../assets/image_1738116304266_0.png){:height 465, :width 589}
		- #### Virtual WAN
			- Simplifies ((67998bd8-540a-47be-a214-f489e49b240c))
			- SKUs
				- Basic
					- S2S VPN
				- Standard
					- Express Route
					- P2S
					- S2S
		- #### Service endpoints
			- VNET accessible endpoint to Services e.g., Storage Account
			- PaaS service is still separate to your VNet, and traffic is leaving your virtual network to access the PaaS service. However, the PaaS service is configured to be able to identify traffic coming from your virtual network
			- Traffic still routed via internet
			- ![image.png](../assets/image_1738117106333_0.png)
		- #### Private endpoints
			- A private NIC of the PaaS is attached to a VNET
			- Can be used for own services not just PaaS
			  ![image.png](../assets/image_1738119274127_0.png)
			-
		- #### Bastion
			- SKUs
				- Basic
				- Developer
					- Access peered VNETs
				- Standard
		- #### Load balancer
			- Regional
				- L7 - App GW
					- WAF can be added
					- SSL termination
					- Listener
						- Types
							- Basic -> single FQDN
							- Multi-site -> multiple FQDN
				- L4 - AZ LB
			- Global
				- Traffic Manager (DNS based routing)
				- Cross-region Load Balancer (L4)
				- Azure Front-door (L7)
					- WAF can be added
		- #### Storage Account
			- SKU
				- GPV2
				- Premium
			- Types
				- Blob
				- File
				- Table
				- Queue
			- Redundancy - minimum 3 copies always
				- LRS - 3 copies in same AZ in region
				- ZRS - 3 copies spread in AZs in region
				- GRS - 3 copies in one AZ in region A and 3 copies on one AZ in region B
				- GZRS - 3 copies spread in one AZ in region A and 3 copies in one AZ in region B **READ_ACCESS** modifier allows to read from replicated region
				- ![image.png](../assets/image_1738123252176_0.png)
			- Access via
				- Portal
				- Storage Explore
				- `AzCopy` CLI
				- Data Box / Disk - large scale data migrations
				- Data Factory - ETL process
			- Blob
				- Tiers
					- Hot
					- Cool
					- Cold
					- Archive (offline - not accessible)
					  ![image.png](../assets/image_1738123749752_0.png)
				- Object Replication
					- can copy object to any region not just the paired region (which is the case in GRS/GZRS)
					- Object replication can be used to replicate blobs between storage accounts. Before configuring object replication, you must enable blob versioning for both storage accounts, and you must enable the change feed for the source account.
				- A timed-based retention policy or legal hold policies can be applied to block deletion. Immutability policies can be scoped to a blob version or to a container.
			- Files
				- Tiers
					- Txn optimised
					- Hot
					- Cool
					- Premium
				- FileSync
					- Replicate on-prem -> Cloud
					  ![image.png](../assets/image_1738124317880_0.png)
					-
			- Shared Access Signature - generated using Access Keys
				- Can be applied at granular levels
			- Encryption
				- Platform Managed Key
				- Customer Managed Key
				- Encryption Scopes - can be applied at container levels
			- Managed disks
				- Belongs to a Storage Account
				  ![image.png](../assets/image_1738127725923_0.png)
				- Encryption
					- "Disk Encryption Set" uses keys in KV
					- OS level encryption
						- BitLocker (Windows)
						- DM-Crypt (Linux)
						  ![image.png](../assets/image_1738127841302_0.png)
			- #### VM
				- Scaling Profile
					- VM template
					- min/max
					- scale rules
			- #### Containers
				- AZ Container Instances
				- AKS
					- Control Plane (Managed)
					- Node Pools
					- Networking
						- Kubenet (not popular)
						- AZ CNI (Pod and Nodes share same IP space)
						- Overlays (Uses own CIDR)
					- Scaling
						- HorizontalPodAutoscalar (HPA)
						- KEDA better than HPA
						- ClusterAutoScalar
			- #### App Service
				- App Service Plan (dedicates capacity e.g., Node Pool)
				- multiple apps can be deployed to same Plan
			- #### Logs
				- Needs to be enabled via Diagnostic Settings
				- Can be sent to
					- Storage
					- Event Hub
					- Analaytics Workspace
				- Analytics Logs (30, 60 days upto 2 years)
				- Basic Logs (8 days retention)
			- #### Alerts
				- Processing Rules
					- Suppress
					- Action Group
			- #### Network Watcher
				- View topology
				- IP flow verify
				- Packet Capture
				-
-
-
-
-
## Language
-
- `let ... in ...` similar to _local variables_ - name `a` can be used in the `in` expression
  ```
  let
  a = 1;
  in
  a + a
  ```
- `with ...; ...` access attr set with specifying the parent
  
  ```
  with a; [ x y z ]
  
  ```
  is equivalent to
  ```
  [ a.x a.y a.z ]
  
  ```
- `inherit ..` inherit is shorthand for assigning the value of a name from an existing scope to the same name in a nested scope.
  
  ```
  let
    x = 1;
    y = 2;
  in
  {
  	inherit x y;
  }
  
  ```
  results in `{ x = 1; y = 2; }`
  `${ ... }`
-
- String interpoloation
- `$x` variables in a shell script generated by a nix expr
- Named attribute set argument for a function
  
  `args@{ a, b, ... }: a + b + args.c` or
  
  `{ a, b, ... }@args: a + b + args.c`
-
-
- ## Derivation
- A derivation is like an `.o` file for a `.c`. A realised derivation is like the `a.out` generated by linking `.o` files
-
- ### Example derivation
- Create `default.nix` which creates an output `sample` that contains what the `builder` produces which is just a some text `foo`
  logseq.order-list-type:: number
  ```
  derivation {
    name = "simple";
    builder = "${(import <nixpkgs> {}).bash}/bin/bash";
    args = [ "-c" "echo foo > $out" ];
    src = ./.;
    system = builtins.currentSystem;
  }
  ```
- Create derivation from `default.nix`
  logseq.order-list-type:: number
  ```
  $ nix-instantiate .
  warning: you did not specify '--add-root'; the result might be removed by the garbage collector
  /nix/store/v3bdm27d85mq33cgzav30njgzgsv79lw-simple.drv
  ```
- Realise the derivation and add to store
  logseq.order-list-type:: number
  ```
  $ nix-store -r /nix/store/v3bdm27d85mq33cgzav30njgzgsv79lw-simple.drv
  this derivation will be built:
    /nix/store/v3bdm27d85mq33cgzav30njgzgsv79lw-simple.drv
  building '/nix/store/v3bdm27d85mq33cgzav30njgzgsv79lw-simple.drv'...
  warning: you did not specify '--add-root'; the result might be removed by the garbage collector
  /nix/store/av3i3vnmkz2khbjp8qgi2296a5i3d2f9-simple
  
  $ cat /nix/store/av3i3vnmkz2khbjp8qgi2296a5i3d2f9-simple
  foo
  ```
- Above 2 steps can be combined using `nix-build`
  logseq.order-list-type:: number
  ```
  $ nix-build .
  /nix/store/av3i3vnmkz2khbjp8qgi2296a5i3d2f9-simple
  ```
-
-
- ## Flakes
- Flakes use new nix CLI `nix xxx` not `nix-xxx`
- With flakes, `NIX_PATH` becomes irrelevant as the flake defines the `nixpkgs`
- However, when using commands like `nix-shell -p xxx` or `nix shell <nixpkgs>#xxx`  it'll use `nixpkgs` from NIX_PATH
  ```
  $ echo $NIX_PATH
  nixpkgs=flake:nixpkgs:/nix/var/nix/profiles/per-user/root/channels
  ```
-
- ## CLI
- Build package
  `nix-build -E 'with import <nixpkgs> {}; callPackage ./package.nix {}'`
- Install from nixhub
  `nix shell nixpkgs/4ae2e647537bcdbb82265469442713d066675275#azure-cli`
- Repair cache
  `nix-store --verify --check-contents --repair`
	- Garbage collect
	  `nix-collect-garbage -d`
- Find what are the deps of an executable
  `nix-store --query --tree $(which cowsay) | cat`
- Load flake to repl using `:lf`
  ```
  nix repl
  nix-repl> :lf ./path/to/flake/dir
  
  # e.g. 
  nix-repl> :lf ./Settings/nix
  nix-repl> inputs
  {
  home-manager = { ... };
  nix-darwin = { ... };
  nixpkgs = { ... };
  nixpkgs-unstable = { ... };
  }
  ```
- Load nix lib using repl
  ```
  nix-repl> :l <nixpkgs/lib>
  Added 446 variables.
  
  nix-repl> concatStringsSep ", " ["hello" "world"]
  "hello, world"
  
  ```
- Dev shell using flake
  ```
  nix develop <flake_dir>.#<shell_name>
  
  # e.g., 
  nix develop ~/Settings/nix/.#python
  ```
-
- ## References
- ### General
- [https://jvns.ca/blog/2023/11/11/notes-on-nix-flakes/](https://jvns.ca/blog/2023/11/11/notes-on-nix-flakes/)
- [https://github.com/evantravers/dotfiles/tree/master](https://github.com/evantravers/dotfiles/tree/master)
- [https://gist.github.com/jmatsushita/5c50ef14b4b96cb24ae5268dab613050](https://gist.github.com/jmatsushita/5c50ef14b4b96cb24ae5268dab613050)
- ### Flakes
- https://nixos-and-flakes.thiscute.world/best-practices/nix-path-and-flake-registry
- [https://www.tweag.io/blog/2020-05-25-flakes/](https://www.tweag.io/blog/2020-05-25-flakes/)
- Packaging
	- [https://dee.underscore.world/blog/home-manager-fonts/](https://dee.underscore.world/blog/home-manager-fonts/)
- Modules
	- [https://xeiaso.net/talks/asg-2023-nixos/](https://xeiaso.net/talks/asg-2023-nixos/)
- https://fasterthanli.me/series/building-a-rust-service-with-nix/part-9